import React, { useState } from 'react';

const AHP_SCALE = [1/9,1/8,1/7,1/6,1/5,1/4,1/3,1/2,1,2,3,4,5,6,7,8,9];

function round(num, decimals = 3) {
  return Number(Math.round(num + 'e' + decimals) + 'e-' + decimals);
}

export default function App() {
  const criteria = ['Cost', 'Quality', 'Speed'];
  const n = criteria.length;

  // Initialize A as identity matrix
  const [A, setA] = useState(() => {
    const matrix = Array(n).fill(0).map(() => Array(n).fill(1));
    for (let i = 0; i < n; i++) {
      for (let j = 0; j < n; j++) {
        if (i === j) matrix[i][j] = 1;
        else if (i > j) matrix[i][j] = 1 / matrix[j][i];
      }
    }
    return matrix;
  });

  // Compute weights by averaging normalized columns
  const weights = (() => {
    // Normalize columns
    const colSums = Array(n).fill(0);
    for (let j = 0; j < n; j++) {
      for (let i = 0; i < n; i++) {
        colSums[j] += A[i][j];
      }
    }
    const normalized = Array(n).fill(0).map(() => Array(n).fill(0));
    for (let i = 0; i < n; i++) {
      for (let j = 0; j < n; j++) {
        normalized[i][j] = A[i][j] / colSums[j];
      }
    }
    // Row averages
    const w = Array(n).fill(0);
    for (let i = 0; i < n; i++) {
      let sum = 0;
      for (let j = 0; j < n; j++) {
        sum += normalized[i][j];
      }
      w[i] = sum / n;
    }
    return w;
  })();

  // Consistency Ratio calculation (simplified)
  const CR = (() => {
    // Random Index (RI) values for n=1..10
    const RI = [0,0,0.58,0.9,1.12,1.24,1.32,1.41,1.45,1.49];
    // Compute weighted sum vector
    const wA = Array(n).fill(0);
    for (let i = 0; i < n; i++) {
      let sum = 0;
      for (let j = 0; j < n; j++) {
        sum += A[i][j] * weights[j];
      }
      wA[i] = sum;
    }
    // Compute lambda max
    let lambdaMax = 0;
    for (let i = 0; i < n; i++) {
      lambdaMax += wA[i] / weights[i];
    }
    lambdaMax /= n;
    const CI = (lambdaMax - n) / (n - 1);
    const cr = RI[n - 1] ? CI / RI[n - 1] : 0;
    return cr;
  })();

  return (
    <div className="App">
      <h1>Analytic Hierarchy Process (AHP)</h1>
      <h2>Step 1: Pairwise Comparison</h2>
      <p className="ahp-help">
        For each upper‑triangle cell (row <em>i</em> vs column <em>j</em>), pick a ratio on the AHP scale
        <span className="mono">[1/9 … 1/2, 1, 2 … 9]</span>.
        Values <span className="mono">&gt; 1</span> mean the <strong>row</strong> criterion is more important than the column; values <span className="mono">&lt; 1</span> mean the <strong>row</strong> is less important (so the column is more important). The diagonal is 1 and the lower triangle auto‑fills with reciprocals. Columns normalize to 1; row averages are the final weights.
      </p>
      <div className="toolbar">
        <div className="cr-badge">
          <span className={`pill ${CR<=0.1? 'ok' : 'warn'}`}>CR: {round(CR,3)} {CR<=0.1? '• acceptable' : '• review'}</span>
        </div>
      </div>
      <table className="table">
        <thead>
          <tr>
            <th></th>
            {criteria.map((c, i) => <th key={i}>{c}</th>)}
          </tr>
        </thead>
        <tbody>
          {criteria.map((rowCriterion, i) => (
            <tr key={i}>
              <th>{rowCriterion}</th>
              {criteria.map((colCriterion, j) => {
                if (i === j) {
                  return <td key={j}>1</td>;
                } else if (i < j) {
                  return (
                    <td key={j}>
                      <select
                        className="ahp-select"
                        value={A[i][j]}
                        onChange={(e)=>{
                          const v = parseFloat(e.target.value);
                          setA(prev=>{
                            const next = prev.map(row=>row.slice());
                            next[i][j] = v;
                            next[j][i] = 1 / v; // enforce reciprocity
                            return next;
                          });
                        }}
                      >
                        {AHP_SCALE.map((x)=> (
                          <option key={x} value={x}>{Number(x).toPrecision(3).replace(/\.0+$/,'')}</option>
                        ))}
                      </select>
                      <span className="ahp-hint">row: {criteria[i]} vs col: {criteria[j]}</span>
                    </td>
                  );
                } else {
                  return <td key={j}>{A[i][j].toPrecision(3)}</td>;
                }
              })}
            </tr>
          ))}
        </tbody>
      </table>
      <h2>Step 2: Weights</h2>
      <ul>
        {criteria.map((c, i) => (
          <li key={i}>{c}: {round(weights[i], 3)}</li>
        ))}
      </ul>
    </div>
  );
}






#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

/* === AHP UI helpers === */
.ahp-help { color:#334155; font-size:0.95rem; margin:0.5rem 0 0.75rem; text-align:left; }
.ahp-help .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; padding-left:0.25rem; }
.ahp-select { padding:0.25rem 0.5rem; border:1px solid #cbd5e1; border-radius:0.5rem; background:#fff; }
.ahp-hint { margin-left:0.5rem; font-size:0.75rem; color:#64748b; }
.cr-badge { margin-left:auto; }
.pill { padding:0.15rem 0.5rem; border-radius:0.5rem; border:1px solid; font-size:0.85rem; }
.pill.ok { background:#ecfdf5; color:#065f46; border-color:#a7f3d0; }
.pill.warn { background:#fffbeb; color:#92400e; border-color:#fcd34d; }

/* Table readability */
.table thead th { background:#f8fafc; color:#0f172a; font-weight:600; }
.table td, .table th { padding:0.5rem; border:1px solid #e2e8f0; }
.table tr:nth-child(even) { background:#fafafa; }
